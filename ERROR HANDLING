-- User defined functions

-- SCALAR, Table valued and System 

--SCALAR 

SELECT * FROM Sales.SalesTerritory

CREATE FUNCTION YTDSALES()
RETURNS MONEY
AS
BEGIN
DECLARE @YTDSALES MONEY
SELECT @YTDSALES = SUM(SALESYTD) FROM Sales.SalesTerritory
RETURN @YTDSALES
END

DECLARE @YTDRESULTS AS MONEY
SELECT @YTDRESULTS = dbo.YTDSALES()
PRINT @YTDRESULTS


-- PARAMETERIZED FUNCTIONS 

SELECT * FROM SALES.SalesTerritory


CREATE FUNCTION YTDGROUP 
(@GROUP VARCHAR(50))
RETURNS MONEY
AS
BEGIN
DECLARE @YTDSALES AS MONEY
SELECT @YTDSALES = SUM(SalesYTD) FROM Sales.SalesTerritory
WHERE [GROUP] = @GROUP
RETURN @YTDSALES
END

DECLARE @RESULTS MONEY
SELECT @RESULTS = dbo.YTDGROUP('NORTH AMERICA')
print @results

DROP FUNCTION YTDGROUP
--fUNCTIONS RETURNING TABLES 

CREATE FUNCTION STB
(@TerritoryID INT)
RETURNS TABLE 
AS RETURN
SELECT Name,CountryRegionCode,[Group],SalesYTD FROM Sales.SalesTerritory
Where TerritoryID=@TerritoryID


SELECT * FROM SALES.SalesTerritory

SELECT * FROM dbo.STB(10)
---------------- Transaction and Error handling 

SELECT * FROM SALES.SalesTerritory

BEGIN TRANSACTION
		UPDATE Sales.SalesTerritory
		Set CostYTD=1
		WHERE NAME = 'Northwest'
COMMIT TRANSACTION

----ERROR 0 = SUCCESS, >0 = MEANS ERROR

